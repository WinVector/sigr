<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Estimate model utility — model_utility • sigr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Estimate model utility — model_utility" />
<meta property="og:description" content="Compute the utility of a model score on a classification data set. For each
threshold of interest we compute the utility of the classification rule of taking all items
with model score greater than or equal to the threshold. The user
specifies the outcome (a binary classification target), a model
score (numeric), and the utility values (positive, negative, or zero) of
each case: true positives, false positives, true negatives, and
false negatives. What is returned is a table of model thresholds
and the total value of using this model score plus the given threshold
as a classification rule. NA is used to mark a threshold where no rows
are selected." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sigr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/lmExample.html">lm example</a>
    </li>
    <li>
      <a href="../articles/sigrFormatting.html">sigr formatting</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://win-vector.com/">Sponsor: Win-Vector LLC</a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimate model utility</h1>
    <small class="dont-index">Source: <a href='https://github.com/WinVector/sigr/blob/master/R/model_utility.R'><code>R/model_utility.R</code></a></small>
    <div class="hidden name"><code>model_utility.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compute the utility of a model score on a classification data set. For each
threshold of interest we compute the utility of the classification rule of taking all items
with model score greater than or equal to the threshold. The user
specifies the outcome (a binary classification target), a model
score (numeric), and the utility values (positive, negative, or zero) of
each case: true positives, false positives, true negatives, and
false negatives. What is returned is a table of model thresholds
and the total value of using this model score plus the given threshold
as a classification rule. NA is used to mark a threshold where no rows
are selected.</p>
    </div>

    <pre class="usage"><span class='fu'>model_utility</span>(
  <span class='kw'>d</span>,
  <span class='kw'>model_name</span>,
  <span class='kw'>outcome_name</span>,
  <span class='kw'>...</span>,
  outcome_target = <span class='fl'>TRUE</span>,
  true_positive_value_column_name = <span class='st'>"true_positive_value"</span>,
  false_positive_value_column_name = <span class='st'>"false_positive_value"</span>,
  true_negative_value_column_name = <span class='st'>"true_negative_value"</span>,
  false_negative_value_column_name = <span class='st'>"false_negative_value"</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>d</th>
      <td><p>A data.frame containing all data and outcome values.</p></td>
    </tr>
    <tr>
      <th>model_name</th>
      <td><p>Name of the column containing model predictions.</p></td>
    </tr>
    <tr>
      <th>outcome_name</th>
      <td><p>Name of the column containing the truth values.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Not used, forces later argument to be specified by name.</p></td>
    </tr>
    <tr>
      <th>outcome_target</th>
      <td><p>truth value considered to be TRUE.</p></td>
    </tr>
    <tr>
      <th>true_positive_value_column_name</th>
      <td><p>column name of per-row values of true positive cases. Only used on positive instances.</p></td>
    </tr>
    <tr>
      <th>false_positive_value_column_name</th>
      <td><p>column name of per-row values of false positive cases. Only used on negative instances.</p></td>
    </tr>
    <tr>
      <th>true_negative_value_column_name</th>
      <td><p>column name of per-row values of true negative cases. Only used on negative instances.</p></td>
    </tr>
    <tr>
      <th>false_negative_value_column_name</th>
      <td><p>column name of per-row values of false negative cases. Only used on positive instances.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>data.frame of all threshold values.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>A worked example can be found here: <a href='https://github.com/WinVector/sigr/blob/main/extras/UtilityExample.md'>https://github.com/WinVector/sigr/blob/main/extras/UtilityExample.md</a>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='kw'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='#base/data.frame.html'>data.frame</a></span>(
  predicted_probability = <span class='fu'><a href='#base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span>),
  made_purchase = <span class='fu'><a href='#base/c.html'>c</a></span>(<span class='fl'>FALSE</span>, <span class='fl'>TRUE</span>, <span class='fl'>FALSE</span>, <span class='fl'>FALSE</span>),
  false_positive_value = <span class='op'>-</span><span class='fl'>5</span>,    <span class='co'># acting on any predicted positive costs $5</span>
  true_positive_value = <span class='fl'>95</span>,     <span class='co'># revenue on a true positive is $100 minus action cost</span>
  true_negative_value = <span class='fl'>0.001</span>,  <span class='co'># true negatives have no value in our application</span>
                                <span class='co'># but just give ourselves a small reward for being right</span>
  false_negative_value = <span class='op'>-</span><span class='fl'>0.01</span>  <span class='co'># adding a small notional tax for false negatives,</span>
                                <span class='co'># don't want our competitor getting these accounts.</span>
  )

<span class='kw'>values</span> <span class='op'>&lt;-</span> <span class='fu'>model_utility</span>(<span class='kw'>d</span>, <span class='st'>'predicted_probability'</span>, <span class='st'>'made_purchase'</span>)
<span class='kw'>best_strategy</span> <span class='op'>&lt;-</span> <span class='kw'>values</span>[<span class='kw'>values</span><span class='op'>$</span><span class='kw'>total_value</span> <span class='op'>&gt;=</span> <span class='fu'><a href='#base/Extremes.html'>max</a></span>(<span class='kw'>values</span><span class='op'>$</span><span class='kw'>total_value</span>), ][<span class='fl'>1</span>, ]
<span class='fu'><a href='#base/t.html'>t</a></span>(<span class='kw'>best_strategy</span>)
</div><div class='output co'>#&gt;                      2                      
#&gt; model                "predicted_probability"
#&gt; threshold            "0.25"                 
#&gt; count_taken          "3"                    
#&gt; fraction_taken       "0.75"                 
#&gt; true_positive_value  "95"                   
#&gt; false_positive_value "-10"                  
#&gt; true_negative_value  "0.001"                
#&gt; false_negative_value "0"                    
#&gt; total_value          "85.001"               
#&gt; true_negative_count  "1"                    
#&gt; false_negative_count "0"                    
#&gt; true_positive_count  "1"                    
#&gt; false_positive_count "2"                    </div><div class='input'>


<span class='co'># a bigger example</span>

<span class='kw'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='#base/data.frame.html'>data.frame</a></span>(
  predicted_probability = <span class='kw'>stats</span>::<span class='fu'><a href='#stats/Uniform.html'>runif</a></span>(<span class='fl'>100</span>),
  made_purchase = <span class='fu'><a href='#base/sample.html'>sample</a></span>(<span class='fu'><a href='#base/c.html'>c</a></span>(<span class='fl'>FALSE</span>, <span class='fl'>TRUE</span>), replace = <span class='fl'>TRUE</span>, size = <span class='fl'>100</span>),
  false_positive_value = <span class='op'>-</span><span class='fl'>5</span>,    <span class='co'># acting on any predicted positive costs $5</span>
  true_positive_value = <span class='fl'>95</span>,     <span class='co'># revenue on a true positive is $100 minus action cost</span>
  true_negative_value = <span class='fl'>0.001</span>,  <span class='co'># true negatives have no value in our application</span>
                                <span class='co'># but just give ourselves a small reward for being right</span>
  false_negative_value = <span class='op'>-</span><span class='fl'>0.01</span>  <span class='co'># adding a small notional tax for false negatives,</span>
  <span class='co'># don't want our competitor getting these accounts.</span>
)

<span class='kw'>values</span> <span class='op'>&lt;-</span> <span class='fu'>model_utility</span>(<span class='kw'>d</span>, <span class='st'>'predicted_probability'</span>, <span class='st'>'made_purchase'</span>)

<span class='co'># plot the estimated total utility as a function of threshold</span>
<span class='fu'><a href='#graphics/plot.default.html'>plot</a></span>(<span class='kw'>values</span><span class='op'>$</span><span class='kw'>threshold</span>, <span class='kw'>values</span><span class='op'>$</span><span class='kw'>total_value</span>)
</div><div class='img'><img src='model_utility-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='kw'>best_strategy</span> <span class='op'>&lt;-</span> <span class='kw'>values</span>[<span class='kw'>values</span><span class='op'>$</span><span class='kw'>total_value</span> <span class='op'>&gt;=</span> <span class='fu'><a href='#base/Extremes.html'>max</a></span>(<span class='kw'>values</span><span class='op'>$</span><span class='kw'>total_value</span>), ][<span class='fl'>1</span>, ]
<span class='fu'><a href='#base/t.html'>t</a></span>(<span class='kw'>best_strategy</span>)
</div><div class='output co'>#&gt;                      2                      
#&gt; model                "predicted_probability"
#&gt; threshold            "0.0240117"            
#&gt; count_taken          "99"                   
#&gt; fraction_taken       "0.99"                 
#&gt; true_positive_value  "5035"                 
#&gt; false_positive_value "-230"                 
#&gt; true_negative_value  "0.001"                
#&gt; false_negative_value "0"                    
#&gt; total_value          "4805.001"             
#&gt; true_negative_count  "1"                    
#&gt; false_negative_count "0"                    
#&gt; true_positive_count  "53"                   
#&gt; false_positive_count "46"                   </div><div class='input'>

<span class='co'># without utilities example</span>

<span class='kw'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='#base/data.frame.html'>data.frame</a></span>(
  predicted_probability = <span class='fu'><a href='#base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span>),
  made_purchase = <span class='fu'><a href='#base/c.html'>c</a></span>(<span class='fl'>FALSE</span>, <span class='fl'>TRUE</span>, <span class='fl'>FALSE</span>, <span class='fl'>FALSE</span>))
<span class='fu'>model_utility</span>(<span class='kw'>d</span>, <span class='st'>'predicted_probability'</span>, <span class='st'>'made_purchase'</span>)
</div><div class='output co'>#&gt;                   model threshold count_taken fraction_taken
#&gt; 1 predicted_probability      0.00           4           1.00
#&gt; 2 predicted_probability      0.25           3           0.75
#&gt; 3 predicted_probability        NA           0           0.00
#&gt;   true_negative_count false_negative_count true_positive_count
#&gt; 1                   0                    0                   1
#&gt; 2                   1                    0                   1
#&gt; 3                   3                    1                   0
#&gt;   false_positive_count
#&gt; 1                    3
#&gt; 2                    2
#&gt; 3                    0</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by John Mount, Nina Zumel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


