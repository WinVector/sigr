<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Compute the distribution of differences of replacement samples of two Binomial or Bernoulli experiments. — Bernoulli_diff_stat • sigr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Compute the distribution of differences of replacement samples of two Binomial or Bernoulli experiments. — Bernoulli_diff_stat" />
<meta property="og:description" content="Assuming max(nA, nB) %% min(nA, nB) == 0:
compute the distribution of differences of weighted sums between
max(1, nB/nA)*sum(a)
and  max(1, nA/nB)*sum(b)
where a is a 0/1 vector of length nA with each item 1 with independent probability (kA+kB)/(nA+nB),
and b is a 0/1 vector of length nB with each item 1 with independent probability (kA+kB)/(nA+nB).
Then return the significance of a direct two-sided test that the absolute value of this difference is at least as large
as the test_rate_difference (if supplied) or the empirically observed rate difference abs(nB*kA - nA*kB)/(nA*nB).
The idea is: under this scaling differences in success rates between the two processes are easily observed as differences
in counts returned by the scaled processes.
The method can be used to get the exact probability of a given difference under the null hypothesis that
both the A and B processes have the same success rate (kA+kB)/(nA+nB).
When nA and nB don't divide evenly into to each
other two calculations are run with the larger process is alternately padded and truncated to look like a larger or smaller
experiment that meets the above conditions.  This gives us a good range of significances." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sigr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/lmExample.html">lm example</a>
    </li>
    <li>
      <a href="../articles/sigrFormatting.html">sigr formatting</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://win-vector.com/">Sponsor: Win-Vector LLC</a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute the distribution of differences of replacement samples of two Binomial or Bernoulli experiments.</h1>
    <small class="dont-index">Source: <a href='https://github.com/WinVector/sigr/blob/master/R/DifferenceDistribution.R'><code>R/DifferenceDistribution.R</code></a></small>
    <div class="hidden name"><code>Bernoulli_diff_stat.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Assuming <code>max(nA, nB) %% min(nA, nB) == 0</code>:
compute the distribution of differences of weighted sums between
<code>max(1, nB/nA)*sum(a)</code>
and  <code>max(1, nA/nB)*sum(b)</code>
where <code>a</code> is a 0/1 vector of length <code>nA</code> with each item 1 with independent probability <code>(kA+kB)/(nA+nB)</code>,
and <code>b</code> is a 0/1 vector of length <code>nB</code> with each item 1 with independent probability <code>(kA+kB)/(nA+nB)</code>.
Then return the significance of a direct two-sided test that the absolute value of this difference is at least as large
as the test_rate_difference (if supplied) or the empirically observed rate difference <code>abs(nB*kA - nA*kB)/(nA*nB)</code>.
The idea is: under this scaling differences in success rates between the two processes are easily observed as differences
in counts returned by the scaled processes.
The method can be used to get the exact probability of a given difference under the null hypothesis that
both the <code>A</code> and <code>B</code> processes have the same success rate <code>(kA+kB)/(nA+nB)</code>.
When <code>nA</code> and <code>nB</code> don't divide evenly into to each
other two calculations are run with the larger process is alternately padded and truncated to look like a larger or smaller
experiment that meets the above conditions.  This gives us a good range of significances.</p>
    </div>

    <pre class="usage"><span class='fu'>Bernoulli_diff_stat</span>(<span class='kw'>kA</span>, <span class='kw'>nA</span>, <span class='kw'>kB</span>, <span class='kw'>nB</span>, <span class='kw'>test_rate_difference</span>, <span class='kw'>common_rate</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>kA</th>
      <td><p>number of A successes observed.</p></td>
    </tr>
    <tr>
      <th>nA</th>
      <td><p>number of A experiments.</p></td>
    </tr>
    <tr>
      <th>kB</th>
      <td><p>number of B successes observed.</p></td>
    </tr>
    <tr>
      <th>nB</th>
      <td><p>number of B experiments.</p></td>
    </tr>
    <tr>
      <th>test_rate_difference</th>
      <td><p>numeric, difference in rate of A-B to test.  Note: it is best to specify this prior to looking at the data.</p></td>
    </tr>
    <tr>
      <th>common_rate</th>
      <td><p>rate numeric, assumed null-rate.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Bernoulli difference test statistic.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Note the intent is that we are measuring the results of an A/B test with <code>max(nA, nB) %% min(nA, nB) == 0</code>
(no padding needed), or <code>max(nA,nB) &gt;&gt; min(nA,nB)</code> (padding is small effect).</p>
<p>The idea of converting a rate problem into a counting problem follows from reading Wald's <em>Sequential Analysis</em>.</p>
<p>For very small p-values the calculation is sensitive to rounding in the observed ratio-difference,
as an arbitrarily small change in test-rate can move an entire set of observed differences in or out of the significance calculation.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'>Bernoulli_diff_stat</span>(<span class='fl'>2000</span>, <span class='fl'>5000</span>, <span class='fl'>100</span>, <span class='fl'>200</span>)
</div><div class='output co'>#&gt; [1] "Bernoulli difference test: (A=2000/5000=0.4, B=100/200=0.5, =0.4038, post 0.1 two sided; p=0.004677)."</div><div class='input'><span class='fu'>Bernoulli_diff_stat</span>(<span class='fl'>2000</span>, <span class='fl'>5000</span>, <span class='fl'>100</span>, <span class='fl'>200</span>, <span class='fl'>0.1</span>)
</div><div class='output co'>#&gt; [1] "Bernoulli difference test: (A=2000/5000=0.4, B=100/200=0.5, =0.4038, prior 0.1 two sided; p=0.004677)."</div><div class='input'><span class='fu'>Bernoulli_diff_stat</span>(<span class='fl'>2000</span>, <span class='fl'>5000</span>, <span class='fl'>100</span>, <span class='fl'>199</span>)
</div><div class='output co'>#&gt; [1] "Bernoulli difference test: (A=2000/5000=0.4, B=100/199=0.5025, =0.4039, post 0.1025 two sided; pL=0.003753, pH=0.00382)."</div><div class='input'><span class='fu'>Bernoulli_diff_stat</span>(<span class='fl'>2000</span>, <span class='fl'>5000</span>, <span class='fl'>100</span>, <span class='fl'>199</span>, <span class='fl'>0.1</span>)
</div><div class='output co'>#&gt; [1] "Bernoulli difference test: (A=2000/5000=0.4, B=100/199=0.5025, =0.4039, prior 0.1 two sided; pL=0.004701, pH=0.00474)."</div><div class='input'><span class='fu'>Bernoulli_diff_stat</span>(<span class='fl'>100</span>, <span class='fl'>200</span>, <span class='fl'>2000</span>, <span class='fl'>5000</span>)
</div><div class='output co'>#&gt; [1] "Bernoulli difference test: (A=100/200=0.5, B=2000/5000=0.4, =0.4038, post 0.1 two sided; p=0.004677)."</div><div class='input'>
<span class='co'># sigr adjusts experiment sizes when lengths</span>
<span class='co'># don't divide into each other.</span>
<span class='fu'>Bernoulli_diff_stat</span>(<span class='fl'>100</span>, <span class='fl'>199</span>, <span class='fl'>2000</span>, <span class='fl'>5000</span>)
</div><div class='output co'>#&gt; [1] "Bernoulli difference test: (A=100/199=0.5025, B=2000/5000=0.4, =0.4039, post 0.1025 two sided; pL=0.003753, pH=0.00382)."</div><div class='input'><span class='fu'>Bernoulli_diff_stat</span>(<span class='fl'>100</span>, <span class='fl'>199</span>, <span class='fl'>2000</span>, <span class='fl'>5000</span>)<span class='op'>$</span><span class='kw'>pValue</span>
</div><div class='output co'>#&gt; [1] 0.003786713</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by John Mount, Nina Zumel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


